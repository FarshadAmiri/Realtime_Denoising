{% extends 'frontend/base.html' %}
{% load static %}

{% block title %}Home - Audio Streaming{% endblock %}

{% block content %}
<div class="main-layout">
    <!-- Left sidebar with friends list -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Welcome, {{ user.username }}</h2>
            <div id="denoise-toggle-container" class="denoise-toggle-container">
                <label for="denoise-toggle" class="denoise-label">
                    <input type="checkbox" id="denoise-toggle" checked>
                    <span>Enable Denoising</span>
                </label>
            </div>
            <button id="start-stream-btn" type="button" class="btn btn-primary">Start Streaming</button>
            <button id="stop-stream-btn" type="button" class="btn btn-danger" style="display:none;">
                <span class="stop-label">Stop Streaming</span>
                <span id="stream-duration" class="stream-duration">00:00</span>
            </button>
            <div id="streaming-indicator" class="streaming-indicator" style="display:none;">
                <span class="dot"></span>
                <span id="streaming-status-text">Streaming now</span>
            </div>
        </div>
        
        <div class="friends-section">
            <h3>Friends</h3>
            <div class="search-box">
                <input type="text" id="search-input" placeholder="Search users...">
                <div id="search-results" class="search-results"></div>
            </div>
            <div id="friends-list" class="friends-list">
                <!-- Friends will be loaded here -->
            </div>
        </div>
        
        <div class="friend-requests-section">
            <h3>Friend Requests</h3>
            <div id="friend-requests-list">
                <!-- Friend requests will be loaded here -->
            </div>
        </div>
        
        <div class="sidebar-footer">
            <a href="{% url 'users:logout' %}" class="btn btn-secondary">Logout</a>
        </div>
    </aside>
    
    <!-- Main content area -->
    <main class="main-content" id="main-content">
        <div class="welcome-message">
            <h1>Welcome to Real-time Audio Streaming</h1>
            <p>Select a friend from the left to view their page or start streaming your audio!</p>
            
            <div class="instructions">
                <h2>How it works:</h2>
                <ul>
                    <li>Search for users and send friend requests</li>
                    <li>Start streaming to share your audio with friends (it will be denoised in real-time)</li>
                    <li>Click on a friend to listen to their live stream or browse their recordings</li>
                    <li>All audio is processed through DeepFilterNet2 for noise reduction</li>
                </ul>
            </div>
        </div>
    </main>
</div>

<script>
const username = "{{ user.username }}";
const csrfToken = "{{ csrf_token }}";
</script>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/main.js' %}"></script>
{% endblock %}
